                                                              February 19, 1986







                ***** *   * *   *  **** *   *   *   ****  *****
                  *    * *  ** ** *     *   *  * *  *   * *    
                  *     *   * * *  ***  ***** ***** ****  **** 
                  *     *   *   *     * *   * *   * *  *  *    
                  *     *   *   * ****  *   * *   * *   * *****

             ****    *    **** *****       *   *  ***   **** *****
             *   *  * *  *     *           *   * *   * *       *  
             ****  *****  ***  ****  ***** ***** *   *  ***    *  
             *   * *   *     * *           *   * *   *     *   *  
             ****  *   * ****  *****       *   *  ***  ****    *  

                ****  ****   ***  *****  ***   ***   ***  *    
                *   * *   * *   *   *   *   * *   * *   * *    
                ****  ****  *   *   *   *   * *     *   * *    
                *     *  *  *   *   *   *   * *   * *   * *    
                *     *   *  ***    *    ***   ***   ***  *****

                               REFERENCE MANUAL

                                   John Kopf
                                Charles Landau
                                David E. Smith

                                    TYMNET
                        NETWORK TECHNOLOGY DEVELOPMENT
                               February 19, 1986








     ====================================================================
     |   Tymnet,  Inc.'s  proprietary  rights  are  included  in  the   |
     |   information disclosed herein.   The recipient,  by receiving   |
     |   this document,  agrees  that neither this  document nor  the   |
     |   information  disclosed  herein nor any part thereof shall be   |
     |   reproduced or transferred to  other  documents  or  used  or   |
     |   disclosed  to  others  for  manufacturing  or  for any other   |
     |   purpose except  as  specifically authorized  in  writing  by   |
     |   Tymnet, Inc.                                                   |
     ====================================================================




                             Tymshare Base-Host Protocols             TBASE.DOC
                                                              February 19, 1986







                                   TABLE OF CONTENTS

        Section                                                            Page


             Preface                                                          1


        1.   Base-Host Interface                                              2
          1.1   TYMNET Overview                                               2
          1.2   The BASE                                                      3
          1.3   Establishing Communication with the BASE                      3
             1.3.1    Host-initiated Reset Dialog                             4
             1.3.2    Base-initiated Reset Dialog                             4
             1.3.3    Protocol errors and Timeouts                            5

          1.4   HOST State                                                    5
          1.5   Building Circuits                                             6
             1.5.1    Externally-initiated Circuits                           6
             1.5.2    Internally-initiated Circuits                           6

          1.6   Tearing Down Circuits                                         8
          1.7   Using Circuits                                                9


                                     APPENDICES
                                     ==========


        I.   'Lemcom'/370 Base-Host Interface                                13
          I-1   Base to Host Packets                                         13
             I-1.1    Env_Data message                                       13

          I-2   Host to Base Packets                                         14
          I-3   Packet Header                                                15
             I-3.1    A "level-2" message                                    15


        II.  Network ID's                                                    17


        III. Terminal Characteristics                                        19


        IV.  Summary of Host-to-Base Messages                                20


        V.   Summary of Base-to-Host Messages                                22

                             Tymshare Base-Host Protocols             TBASE.DOC
                                                              February 19, 1986




                                      INDEX
                                      =====                                  24


















































                             Tymshare Base-Host Protocols             TBASE.DOC
                                                              February 19, 1986






                                        Preface



             This document is one of  a family of documents related  to TYMNET,
        and  describing  various aspects  of  the TYMNET  features  and related
        protocols.

             The various documents (and their subject) included are:

         ACCT2.DOC    This   document   describes   TYMNET   accounting-II  (to
                      supercede ACOUNT.DOC).

         ACOUNT.DOC   This   document  describes   TYMNET  accounting   (to  be
                      superceded by ACCT2.DOC.)

         CIRCUI.DOC   This   document  describes   TYMNET   circuit  protocols,
                      including ball logic and terminal characteristics.

         DEVICE.DOC   This document describes  certain TYMNET devices,  as used
                      on the TYMNET ENGINE.

         NET1.DOC     This  document   describes  nodes,   line-protocols,  and
                      supervisor communications within TYMNET-I.

         TBASE.DOC    This document describes the TYMSHARE Base-Host interface.
























        1                    Tymshare Base-Host Protocols             TBASE.DOC
        Base-Host Interface                                   February 19, 1986






                               1 -  Base-Host Interface


             This chapter describes the protocol used between  certain TYMSHARE
        hosts, such as IBM-370, and  the specialized BASE or TYMCOM  (ISIS Host
        Interface)  connecting  them  to  TYMNET.   It  does  not  describe the
        hardware used to connect a host to TYMNET.  Here the hardware is viewed
        as a mechanism for  transmitting messages consisting of some  number of
        eight-bit bytes to and from TYMNET.

               NOTE:   Do not confuse base-host messages with the format
                       of data and control signals for a  circuit within
                       TYMNET.






                                 1.1  TYMNET Overview


             A TYMNET Circuit is a full-duplex communication path for  data and
        control signals between two ports bounding TYMNET.

             A circuit is like two pipes:  The information that flows through a
        pipe is  in the  form of 8-bit  characters;  these  may be  either data
        bytes or control signals.  In each pipe the information always flows in
        the same direction;  the individual bytes never get out of sequence.

             The pipes  are somewhat  elastic, but  the information  within the
        pipe  can get  crowded,  either because  the information  is  not being
        removed from the end  of the pipe fast  enough, or because the  flow is
        restricted.    Normally,   when  characters   get   crowded  (increased
        pressure),  they   simply  back-up   in  the   pipe  ("back-pressure").
        Occasionally,  the information  get over-crowded,  and it  necessary to
        relieve  the  pressure.   When  this  happens,  a  contiguous  block of
        information  is discarded  and replaced  by a  control signal  called a
        "Black-Ball".  Since the Black-ball is smaller than the  information it
        replaces, the pressure is relieved.










        2                    Tymshare Base-Host Protocols             TBASE.DOC
        Base-Host Interface                                   February 19, 1986


                                     1.2  The BASE


             A host communicates with a  part of TYMNET called a  base.  TYMNET
        identifies a base port with a node number, identifying the base,  and a
        base port number.  The base port number is assigned by TYMNET, and does
        not necessarily  correspond to  the host port  number for  a particular
        circuit.  The host  port number is likely  to be assigned  to different
        base ports for successive circuits.  Host port numbers range  from zero
        up to but not  includ limit called  the base port limit.   For the
        370 bases the base port limit is currently 254 for TYMNET-II and 62 for
        TYMNET-I.

             Messages  transfered between  the host  and base  are  packed into
        Packets, and the packets are the entity transmitted.

             Messages to and  from the base  are summarized in  the appendices.
        Numbers in these tables are hexadecimal.  A comma separates bytes  in a
        message.  All bytes are considered to be unsigned.  The first byte of a
        message is a type code.  The  length of a message is a function  of the
        type code.   Any base-to-host message  which is shown  as being  an odd
        number of  bytes in length  has an  extra byte at  the end,  not shown,
        whose contents is of  no significance.  Thus all  base-to-host messages
        are an even number  of bytes in length,  and each message starts  on an
        even byte-boundary (half-word) within a packet.

             In these tables, the symbol "P" indicates a host port  number, and
        it must  be less  than the base  port limit  (otherwise the  message is
        invalid).  Other symbols are explained below.

               NOTE:   Any message not listed in the table is invalid.






                     1.3  Establishing Communication with the BASE


             In order to establish communications betwen the host and the base,
        it is  first necessary to  reset the interface,  using a  Reset Dialog.
        The reset may be initiated by either the host or by the base:











        3                    Tymshare Base-Host Protocols             TBASE.DOC
        Base-Host Interface                                   February 19, 1986


                    1.3.1  Host-initiated Reset Dialog

             When the host wishes to reset the interface, the following occurs:

           []  The host  assumes all circuits  through the interface  have been
               zapped;  however, it does not send any corresponding  zappers to
               the base.  It  assumes any outstanding  circuit-building dialogs
               have been terminated.
           []  The  host  sends a  Reset_Interface  message to  the  base;  the
               signature  field  (D1-D8)  specifies a  unique  number  for this
               Reset_Interface message.

               Note:   The  host  will typically  include  a Set_Timeout
                       message and a Set_Host_Number message in the same
                       packet as  the Reset_Interface message.   (It may
                       include other messages as it sees fit.)

             On receipt  of the  Reset_Interface message,  the base  resets the
        interface.  It  then processes  the rest of  the packet  containing the
        Reset_Interface message.  The  base then sends  a Reset_Acknowledgement
        message   to  the   host.   The   signature  (D1-D8)   in   the  Reset_
        Acknowledgement  message matches  that in  the  Reset_Interface message
        sent by the host.

             When the base resets the interface, the following occurs:

           []  All circuits through the  interface are zapped (but  zappers are
               not sent to the host).
           []  Any circuit-building dialogs are terminated.
           []  The timeout period is set to 60 seconds.
           []  The interface is considered down.

             The next level-1 message the host receives should have  a matching
        Reset_Acknowledgement  message.   If  not, the  host  starts  the reset
        dialog from the beginning again.





                    1.3.2  Base-initiated Reset Dialog

             When  the  base wishes  to  start a  reset  dialog,  the following
        occurs:

           []  The base resets the interface.
           []  The  base sends  a Reset_Interface  message to  the host  with a
               signature  field  (D1-D8)  of  "1234567812345678".   This packet
               should have no ordinary messages.
           []  On receipt of the Reset_Interface message, the host  initiates a
               reset dialog.
           []  If the  next packet  the base  receives does  not have  a Reset_
               Interface message, the base will start the reset dialog over.

        4                    Tymshare Base-Host Protocols             TBASE.DOC
        Base-Host Interface                                   February 19, 1986


                    1.3.3  Protocol errors and Timeouts

               NOTE:   When  the  host  detects a  protocol  error  in a
                       record from the  base, or times-out the  base, it
                       should initiate  a reset  dialog.  The  base does
                       likewise.






                                    1.4  HOST State


             TYMNET considers each host to  be either up or down.  A  host goes
        down when its interface  is reset.  A host  comes up when it  sends its
        base  a   Set_Host_Number,  Host_Open,   or  Host_Shut   message.   The
        supervisor will not build circuits to a host which is down.

             TYMNET  remembers  a  host  number for  each  host.   When  a base
        receives a Set_Host_Number message, if the HN1/HN2 bytes of the message
        is nonzero the  host number for  this host is  set to HN1_HN2.   If two
        hosts have the same host  number confusion will result.  The  host port
        limit for this host  is set to the NP  field of the message if  that is
        nonzero, otherwise to 48.  The NP  field must be less than or  equal to
        the base port limit  (otherwise the message is invalid).   In addition,
        if this is not the  first Set_Host_Number message since the  host began
        exercising  the  hardware  interface  since  the  interface  was reset,
        circuit zappers are sent on all circuits from this host.

             A host is considered to be either open or shut.   The Host_is_Open
        message causes  the host  to be open.   The Host_is_Shut  and Set_Host_
        Number messages  cause the host  to be shut.   The supervisor  will not
        build  to  a shut  host  circuits  whose username  does  not  have shut
        override.

             When the  host sends a  Test_Pattern_Probe message, the  base will
        send a Test_Pattern_Response message with the same data in the  D1, D2,
        D3, and D4 bytes.

             When  a  host comes  up,  or in  response  to  a Supervisor_Clock_
        Request, the base will send a Supervisor_Clock_Data message.  Bytes T1,
        T2, T3, and  T4 form a  32 bit binary  number (T1 is  most significant)
        which is the number of seconds since GMT 00:00:00 1 January 1974.









        5                    Tymshare Base-Host Protocols             TBASE.DOC
        Base-Host Interface                                   February 19, 1986


                                1.5  Building Circuits


             When  a  circuit is  built,  one end  is  the  caller (initiating,
        origination) end, the other  is the callee (passive,  destination) end.
        The callee  is also known  as a  HOST;  circuits can  only be  built to
        HOSTS.





                    1.5.1  Externally-initiated Circuits

             When  a  circuit  is  built  to  a  host,  that  host  receives an
        Externally-Initiated_New_Circuit  message.  An  available host  port is
        selected on the host and the message identifies the newly assigned host
        port number.   The host  port number will  be less  than the  host port
        limit.  The following data bytes are placed in the circuit going to the
        callee, in order:

           [0] The terminal type code for the circuit (see appendix).
           [1] The high 6 bits of the node number of the initiating port (right
               justified).
           [2] The low 6 bits of the node number of the initiating  port (right
               justified).
           [3] The base or remote port number of the initiating port.
           [4] If the  username of  the circuit has  shut override,  (ASCII "!"
               (hex 21), otherwise no data byte is sent in this position.
           [5] The upper case ASCII characters of the username of the circuit.
           [6] The login line terminator of the circuit (semicolon  or carriage
               return).
           [7] If the  number of data  bytes in [0]  through [6] is  odd, zero,
               otherwise no data byte is sent in this position.

             The data bytes and control  codes sent by the initiating  end will
        arrive subsequent to the above information.

               NOTE:   the  above  information is  subject  to character
                       gobblers.





                    1.5.2  Internally-initiated Circuits

             A host can initiate building  a circuit; such a circuit  is called
        an auxiliary  circuit.  The  host begins  a circuit-building  dialog by
        sending  a  Supervisor_Request_message  (to  the  base).   The  Q field
        ("requesting port") of this message identifies this particular circuit-
        building dialog.  There must not be another circuit-building  dialog in


        6                    Tymshare Base-Host Protocols             TBASE.DOC
        Base-Host Interface                                   February 19, 1986


        progress by this host with the same Q field.  All Q fields must be less
        than the base port limit (otherwise the message is invalid).

             When the supervisor is willing to proceed with the dialog the host
        will receive a  Supervisor_Response_message with a Q  field identifying
        this dialog.  The E field will be zero.  Then the host sends a sequence
        of Supervisor_Login_Character messages.   Again, the Q  fields identify
        the dialog.  The D fields  of these messages contain the  login string,
        consisting of the following ASCII characters, in order:

           11] The string to be used as the username of the circuit.
           12] A colon.
           [3] The decimal  representation of  the host number  of the  host to
               which the circuit is to  be built (the destination host);  or an
               asterisk,  signifying the  host number  of the  supervisor.  The
               username must be valid on the destination host.
           [4] The character  to be used  as the login  line terminator  of the
               circuit, which must be semicolon or carriage return.

             An  available  host  port  will be  selected  to  be  used  as the
        initiating port.  Its host port number will be less than the  host port
        limit.  If the circuit is successfully built the host will then receive
        an Internally-Initiated_New_Circuit message giving (in the P field) the
        (newly assigned) initiating  host port number.   This is followed  by a
        Supervisor_Response message with a Q field identifying this  dialog and
        a  zero  E field.   This  second Supervisor_Response  message  ends the
        dialog.

             If the circuit could not  be built (for any of the  reasons listed
        below), the host  will receive a  Supervisor_Response message with  a Q
        field identifying this  dialog and with a  nonzero error code in  the E
        field telling the reason for the failure:

           Error Code              Meaning

           1   Format error in login string;
           2   Username not in MUD;
           3   MUD unreadable due to disk error;
           4   Other (including destination host down, destination  host cannot
               be  reached through  the network,  circuits busy,  initiating or
               destination  host out  of ports,  destination host  is  shut and
               username  does not  have shut  override, username  not  valid on
               destination host, etc.);
           5   Error related to downline load or dialout request;
           6   Timeout.  Host was slow  in sending login string  and/or network
               was slow in building circuit;
           7   Access not permitted, or ISIS node code has rejected request;
           8   out of origination-ports;
           9   Supervisor  will  not  honor requests  at  this  time--try again
               later.

             This second Supervisor_Response message ends the dialog.


        7                    Tymshare Base-Host Protocols             TBASE.DOC
        Base-Host Interface                                   February 19, 1986


             The supervisor does  not require the  host to supply  the password
        for the username.

             At  any time,  the host  may receive  a  Supervisor_Reset message.
        This message indicates that the supervisor is terminating  all circuit-
        building  dialogs  with  this   host.   This  will  be   an  infrequent
        occurrence.  Note that a circuit may have been built even if the dialog
        is terminated  in this  manner (instead  of by  a Supervisor_Response).
        The host may initiate  the dialogs again after receiving  this message.
        Also, if the most recent of the events (1) interface was reset  and (2)
        host sent a Set_Host_Number message was (1), the host port limit is set
        to 48.

             Auxiliary  circuits have  a terminal  type code  of 0  and  a high
        throughput capability.

             After a circuit has been built the distinction between  caller and
        callee is of no significance.






                              1.6  Tearing Down Circuits


             Either end  of a  circuit can initiate  tearing the  circuit down.
        When the host  sends a Circuit_Zapper_message  to the base,  a circuit_
        zapper  control-signal  is  sent  on  the  specified  circuit.   When a
        circuit_zapper is sent on  a circuit (including the cases  of resetting
        the  interface and  using the  Set_Host_Number message),  no subsequent
        messages may be sent  by the host on that  port until a new  circuit is
        established on it; if they are, they will be discarded.

             After the zapper is  sent, the next base-to-host  transmission may
        contain  messages from  that circuit,  but no  subsequent transmissions
        will.  If there was a base-to-host transmission in progress at the time
        the zapper is  sent, that transmission  may contain messages  from that
        circuit but no subsequent transmissions will.  In any case, if the port
        number is used in a new Externally- or Internally-Initiated_New_Circuit
        message, subsequent messages will be from the new circuit, not  the old
        one.   Also,  if the  host  receives a  Circuit_Zapper  message  from a
        circuit, it will receive no subsequent messages from that circuit.

             A port is either free or  busy.  A free port becomes busy  when it
        is assigned to a  circuit by TYMNET.  Except in  unusual circumstances,
        the  host  will  be  notified  that a  port  has  been  assigned  by an
        Externally-  or   Internally-Initiated_New_Circuit  message.    A  port
        becomes free when a circuit zapper is sent on it.

             If a message arrives at a port from a circuit and messages may not


        8                    Tymshare Base-Host Protocols             TBASE.DOC
        Base-Host Interface                                   February 19, 1986


        be delivered (because a zapper  was sent on that port), the  message is
        discarded.






                                  1.7  Using Circuits


             The base sends  the host a  Backpressure_On message when  the pipe
        leading out  of the port  becomes crowded.  The  base sends the  host a
        Backpressure_Off message when the pipe leading out of the  port becomes
        not crowded.  Initially the pipes of a circuit are not crowded.

             If a host sends messages (other than character gobblers or circuit
        zappers) on the port while the pipe leading out of it is crowded, there
        is an increased chance of  black balls being created, i.e.   data loss.
        If  there  is  a   host-to-base  transmission  in  progress   when  the
        Backpressure_On message is received, the host may be unable  to prevent
        some  messages  (i.e.   those  that are  part  of  the  transmission in
        progress) from being sent on the  port.  It is believed that up  to 150
        data  bytes  may  be  sent  in  this  situation  without  significantly
        increasing the chances of  black balls being created.  It  is possible,
        though  unlikely,  for black  balls  to  be created  even  if  the host
        strictly obeys this backpressure protocol.

             The base considers a host  to be willing to receive messages  on a
        port or not.  When a circuit is built the host is  initially considered
        to  be willing  to receive  messages  on the  port.  The  host  sends a
        Backpressure_On   message  to   indicate   it  is   unwilling,   and  a
        Backpressure_Off  message  to  indicate it  is  willing.   When  a host
        indicates it is unwilling, the base will quickly stop  delivering Data_
        Bytes messages on that  port.  However, character gobblers  and circuit
        zappers will  be delivered regardless  of the host's  willingness.  The
        rules determining when messages will  stop are the same as in  the case
        where  the  host  sends  a  Circuit_Zapper  message.   When  a  host is
        unwilling to receive messages, the  messages coming to it will  back up
        in the pipe, and eventually the sending port will be notified  that the
        pipe is crowded ("propagation of backpressure").

             The following host-to-base  messages will cause  the corresponding
        control-signal to be sent on the port identified in the P field:










        9                    Tymshare Base-Host Protocols             TBASE.DOC
        Base-Host Interface                                   February 19, 1986


                Circuit Zapper
                Character Gobbler
                Enter Deferred Echo Mode
                Leave Deferred Echo Mode
                Green Ball
                Red Ball
                Yellow Ball
                Orange Ball
                Hang Character
                Enter Transparency Mode
                Leave Transparency Mode
                Enter Alternate Output Device Mode
                Leave Alternate Output Device Mode

             The host-to-base messages  Echo_On and Echo_Off are  equivalent to
        Set_Terminal_Characteristics(0:1 and 0:0 respectively).

             If  TC  is   not  equal  to  5   (Input_Baud_Rate),  Set_Terminal_
        Characteristics    and    Probe_Terminal_Characteristics    cause   the
        corresponding control signal to be sent.  If TC is 5, then only a local
        variable kept by the base for each circuit is set or  probed.   This is
        done because  of incompatibilities in  various TYMSATS in  the network,
        and terminal characteristic 5 will eventually be treated like the other
        terminal characteristics.  If a variable is set to a value  bigger than
        will fit, the low-order bits will be used (truncated).

             Probe_Terminal_Characteristics(63)  is  exactly  equivalent  to 19
        Probe_Terminal_Characteristics(TC) messages with values of TC from 0 to
        19   inclusive.     For   other    values   of    TC,   Probe_Terminal_
        Characteristics(TC) is ignored.

             The Data_Bytes message has a variable length format (see summary).
        N must be in the range 0  <= n <= 177 octal.  The message  contains the
        type, which is 200  octal + n, the host  port number, and n  data bytes
        which are to be sent on the circuit.

             Note that the following control codes cannot be sent by a host:


                black ball
                gray ball
                break character
                terminal characteristics response(tc, val)

             The  following  control  codes  arriving  on  a  circuit  cause  a
        corresponding message  to be  sent to  the host  (subject to  the rules
        above about zapping and willingness):







        10                   Tymshare Base-Host Protocols             TBASE.DOC
        Base-Host Interface                                   February 19, 1986



                circuit zapper
                character gobbler
                green ball
                red ball
                yellow ball
                orange ball
                black ball
                gray ball
                enter deferred echo mode
                leave deferred echo mode
                break character
                terminal characteristics response(tc, val)
                port status(d)

             When data  bytes arrive from  a circuit, the  host will  receive a
        Data_Bytes message.   The data bytes  are not necessarily  grouped into
        base-to-host messages  in the  same groups in  which they  pass through
        TYMNET.   The format  is the  same as  for the  host-to-base Data_Bytes
        message.

             The following control  codes are discarded  when they arrive  at a
        base port:

                enter transparency mode
                leave transparency mode
                enter alternate output device mode
                leave alternate output device mode
                probe terminal characteristics(tc)
                hang character
























        11                   Tymshare Base-Host Protocols             TBASE.DOC
                                                              February 19, 1986



























                      *   ****  ****  ***** *   * ****  ***** *   *
                     * *  *   * *   * *     **  * *   *   *    * * 
                    ***** ****  ****  ****  * * * *   *   *     *  
                    *   * *     *     *     *  ** *   *   *    * * 
                    *   * *     *     ***** *   * ****  ***** *   *
























        12                   Tymshare Base-Host Protocols             TBASE.DOC
        'Lemcom'/370 Base-Host Interface                      February 19, 1986






                    APPENDIX I.   'Lemcom'/370 Base-Host Interface



             The  host  and  the base  exchange  packets  (transmission blocks)
        alternately.   Each inspects  the received  packet before  sending one.
        Neither sends a  packet until it receives  one in response to  the last
        one it sent.

               Note:   The base will always send a level-2  message with
                       sequence  number  n  in  response  to  a  level-2
                       message from the host with sequence number n.






                               I-1  Base to Host Packets


             A base-to-host  packet consists  of a packet  header, zero  or one
        Env_Data messages, and a "level-1" message.

             A base-to-host packet always has an even number of bytes and never
        has more than 406 (decimal) bytes.





                    I-1.1  Env_Data message

             This message consists of the following:

               A byte containing 56 (octal 70, X'38')

               A byte containing   1   +   the   number   of   bytes  of
                       environmental data.  This byte must be > 0.

               A byte containing  a  version  number  which  defines the
                       format of the environmental data.

               Zero to 254 bytes of environmental data.

             Environmental  data  may  be  supplied  by  the  base  whenever it
        chooses.  The data provides  information about conditions in  the base,
        and is intended  mostly for debugging  and diagnostic purposes.   It is


        13                   Tymshare Base-Host Protocols             TBASE.DOC
        'Lemcom'/370 Base-Host Interface                      February 19, 1986


        anticipated that the base will send environmental data with any  Nak or
        Reset  message.  At  a  minimum, this  data  is displayed  on  the host
        operator's console.

             Versions  zero  and one  are  the only  version  numbers currently
        defined.  For both versions,  the first byte of the  environmental data
        identifies the cause of the most recent reset:

               0 -     Reset message from host

               1 -     Base  slot  code crashed  and  restarted.  Tymnet
                       development should be notified.

               2 -     base timed out host

               3 -     message format error in message from host

               4 -     sequence error in packet from host

               5 -     checksum error in packet from host

               6 -     invalid message type in message from host

               7 -     base slot code has been reloaded

             Version  0  contains only  the  single byte.   Version  1 contains
        additional information:

               2 bytes - slot code version number

               2 bytes - slot number

               2 bytes - ISIS version number

               2 bytes - Node number

               2 bytes - Kernel host number






                               I-2  Host to Base Packets


             A host-to-base packet consists of a packet header and  a "level-1"
        message.

             A host-to-base packet always has an even number of bytes and never
        has more than 2044 (decimal) bytes.



        14                   Tymshare Base-Host Protocols             TBASE.DOC
        'Lemcom'/370 Base-Host Interface                      February 19, 1986


                                  I-3  Packet Header


               Bytes 0 and 1 must have X'00FF'.

               Bytes  2 and  3 contain  a checksum.   All of  the packet
                       following byte  3 is  considered to  be halfwords
                       (byte  pairs) and  bytes  2 and  3  contain their
                       exclusive or.

               Byte 4 contains a sequence number.

               Byte 5  contains the number  of halfwords in  the packet.
                       For  base-to-host  packets, this  count  does not
                       include bytes 0 and 1.  For host-to-base packets,
                       it does.

             A "level-1" message is one of the following:

             A Nak message.  The sequence number in the header is zero.

             A Nak message consists of a byte of 55 (octal 67, hex 37) followed
        by a byte of  zero.  Its meaning is  that the last packet  was received
        with a checksum error or hardware error indicating loss of data.

             The response to a single  Nak message should be to  retransmit the
        last packet sent with the original sequence number.  If a second Nak is
        received, indicating that the retransmitted message is still  in error,
        it should be regarded as a protocol error.





                    I-3.1  A "level-2" message

             A "level-2" message is one of the following:

               A  Reset  message  followed  by  any  number  of ordinary
                       messages.  The sequence  number in the  header is
                       zero.  A Reset message consists of a byte of 3, a
                       byte of 0, and eight bytes of "signature".

               A Reset  Ack message followed  by any number  of ordinary
                       messages.  The sequence  number in the  header is
                       zero.  The Reset Ack message is valid only in the
                       base-to-host  direction.   A  Reset  Ack  message
                       consists of a byte of  4, a byte of 0,  and eight
                       bytes of "signature".

               Any number of ordinary messages.  The sequence  number in
                       the header is the sequence number in the previous
                       level-2 message plus one, mod 256.

        15                   Tymshare Base-Host Protocols             TBASE.DOC
        'Lemcom'/370 Base-Host Interface                      February 19, 1986


             An ordinary  message is  any message other  than Env  Data, Reset,
        Reset Ack, or Nak.

             A message is never split across packets.


















































        16                   Tymshare Base-Host Protocols             TBASE.DOC
        Network ID's                                          February 19, 1986






                              APPENDIX II.   Network ID's



             A  part of  the Externally-initiated_New_Circuit  is a  byte which
        specifies the Network_ID.  This byte will have the two  high-order bits
        on (X'C0);  the next bit  (X'20) is on  if the terminal  is half-duplex
        (this affects the echoing rules applied by the host).  The  low-order 5
        bits specify the Network ID (NID).  The NIDs are tabulated below:


        Network        Terminal         Input[/output]
          Type          Class   TIC       Baud Rate
        (NID, dec.)

            0                   - - -           Auxiliary circuit
            1           ASCII    A,Y    300
            2           ASCII     C     300
            3           ASCII    E,I    300
            4           ASCII     G     300
            5           ASCII     B     150
            6           ASCII     F     150
            7           ASCII     J     150
            8           2741     <CR>   300     (i.e. a 3767 in 2741 mode)
            9           2741     <CR>   134
           10           ASCII     D     110
           11           2780    - - -
           12           ASCII   A,G,I   1200, 2400, 4800 (TPC = 1)
           13                   - - -           Burroughs Polled
           14                   - - -           Aux Through Gateway
           15                   - - -   Variable:  Baudot
           16           ASCII   A,G,I   2400 (TPC = 2)
           17                   - - -           3270
           18                   - - -           3270 Printer
           19           ASCII   A,G,I   4800 (TPC = 2)
           20           ASCII   A,G,I   9600 (TPC = 3)
           21                   - - -           Multiplexed PVC
           22                   - - -           Audio Response
           23                   - - -   75/1200 (TPC = 1)











        17                   Tymshare Base-Host Protocols             TBASE.DOC
        Network ID's                                          February 19, 1986


               NOTE:   The  column labeled  TIC (Terminal-identification
                       Code) specifies (where appropriate) the character
                       the user  would enter in  response to  the TYMSAT
                       "Please type your terminal identifier" message.


               NOTE:   "TPC"  specifies the  default  network throughput
                       capability:

                        0       64 bytes/second
                        1       256 bytes/second
                        2       512 bytes/second
                        3       limited by TYMNET bandwidth available.









































        18                   Tymshare Base-Host Protocols             TBASE.DOC
        Terminal Characteristics                              February 19, 1986






                       APPENDIX III.   Terminal Characteristics



             Each  ASCII  terminal  has  a  set  of  variables  called terminal
        characteristics (TC's).  These are used in  the Set_Terminal_Character-
        istic,   Probe_Terminal_Characteristic,   and  Terminal_Characteristic_
        Response messages.  The TC values are tabulated below:

        TC Code Name                No. of bits
        (dec.)

           1    Echo Control-I          1
           2    Echo CR on LF           1
           3    Echo LF|RUB on CR       1
           4    Delay after CR          1
           5    Input Baud Rate Code    4
           6    Output Baud Rate Code   4
           7    Parity                  1
           8    Half Duplex             1
           9    Parameter A             3
          10    Parameter B             4
          11    Parameter C             4
          12    X-enable                1
          13    Echo Control-H          1
          14    Reverse X-enable        1
          15    Katakana                1
          16    Term. Output on Break   1
          17    Echo-ESC                1
          18    "Q"-mode                1

               NOTE:   On  some  TYMSATs,  Echo  Control-H,  Reverse  X-
                       enable, Echo-ESC, and "Q"-mode are always zero.

















        19                   Tymshare Base-Host Protocols             TBASE.DOC
        Summary of Host-to-Base Messages                      February 19, 1986






                    APPENDIX IV.   Summary of Host-to-Base Messages



        Message Format                  Message Name

            1                           Host is Open
            2                           Host is Shut
            3, 0, d1, ..., d8           Reset Interface...Interpreted by
                                        base as 1-char message telling base
                                        that host has crashed.
            4                           Host tells base to crash host
            8, p                        Backpressure On
            9, p                        Backpressure Off
           0A, p                        Character Gobbler
           0B, p                        Circuit Zapper
           0C, p                        Enter Deferred Echo Mode
           0D, p                        Leave Deferred Echo Mode
           0E, p                        Green Ball
           0F, p                        Red Ball
           10, p                        Yellow Ball
           11, p                        Orange Ball
           12, p                        Hang Character
           13, p                        Enter Transparency Mode
           14, p                        Leave Transparency Mode
           16, q, 0                     Supervisor Request
           18, q, d                     Supervisor Login Character
           19, 0, d1, d2, d3, d4        Test Pattern Probe
           1B, 0, d1, d2, d3, d4        Host Sad
           1C, p                        Echo On
           1D, p                        Echo Off
           1E, p, tc, val               Set Terminal Characteristics
           1F, p, tc                    Probe Terminal Characteristics
           21, np, hn1, hn2             Set Host Number
           22, 0                        Supervisor Clock Request
                                        (Ignored by base)
         * 24, p, d1, ..., d5           Block Output Request
         * 26, p, d1, ..., d5           Block Input Request
         * 2A, p                        Terminate Block Input
         * 2C, p                        Terminate Block Output
         * 2E, 0, np                    Request for Block IO Ports
           31, p                        Enter Alternate Output Device Mode
           32, p                        Leave Alternate Output Device Mode
                        31-32 ignored by base
        ** 33                           Set 4096 second timeout
        ** 34                           Set 60 second timeout
        ** 35, k                        Send key
        ** 36, c                        Send cost
           37, 0                        Negative Acknowledgement

        20                   Tymshare Base-Host Protocols             TBASE.DOC
        Summary of Host-to-Base Messages                      February 19, 1986


           38, len, ver, d1...          Environmental data
                        37-38 used by LEMCOM only
         80+n, p, n bytes of data       Data Bytes

             *  PDP-10 only.

             ** IBM370 only.















































        21                   Tymshare Base-Host Protocols             TBASE.DOC
        Summary of Base-to-Host Messages                      February 19, 1986






                    APPENDIX V.   Summary of Base-to-Host Messages



        Message Format                  Message Name

            3, 0, d1 ... d8             Reset Interface
                                        IBM370 only, 1 byte message
            4, 0, d1 ... d8             Reset Acknowledge
                                        IBM370 only, 1 byte message
            5                           Supervisor Takeover
            6, p [, *x]                 Externally-Initiated New Circuit
                                        PDP10 contains another byte,
                                        which is SR3 from LEP5 msg
            7, p [, *x]                 Internally-Initiated New Circuit
                                        PDP10 contains another byte,
                                        which is SR3 from LEP5 msg
            8, p                        Backpressure On
            9, p                        Backpressure Off
           0A, p                        Character Gobbler
           0B, p                        Circuit Zapper
           0C, p                        Enter Deferred Echo Mode
           0D, p                        Leave Deferred Echo Mode
           0E, p                        Green Ball
           0F, p                        Red Ball
           10, p                        Yellow Ball
           11, p                        Orange Ball
           15, p, 0                     Gray Ball
           15, p, FF                    Black Ball
           17, q, e                     Supervisor Response
           1A, 0, d1, d2, d3, d4        Test Pattern Response
           20, p, tc, val               Terminal Characteristics Response
           23, 0, t1, t2, t3, t4        Supervisor Clock Data
         * 25, p                        Block Output Done
         * 27, p, c1, c2                Block Input Done
         * 28, p, c1, c2                Block Input EOT
         * 29, p, c1, c2                Block IO Timeout
         * 2B, p, c1, c2                Response to Input Termination
         * 2D, p                        Resp. to Output Termination
         * 2E, 0, np                    Resp. to Block IO Port Request
           2F, p                        Break Character
                                        3 byte msg on PDP10, 3rd byte = 0
           30, p, v                     Special Port Condition
                                         CR Delay and Input Baud Rate
           37, p                        Negative Acknowledgement
           38, len, ver, d1, ...        Environmental Data
                        37 - 38 used by LEMCOM only
         80+n, p, n bytes of data       Data Bytes


        22                   Tymshare Base-Host Protocols             TBASE.DOC
        Summary of Base-to-Host Messages                      February 19, 1986


             *  PDP 10 Block I/O only.





















































        23                   Tymshare Base-Host Protocols             TBASE.DOC
        INDEX                                                 February 19, 1986


                                         INDEX

        auxiliary circuit  6                  shut, host  5


        BASE  2, 3                            TC's  19
        base port limit  3                    terminal characteristics  19
        busy port  8                          termination, circuit  6
                                              TPC  18
                                              TYMCOM  2
        Callee  6                             TYMNET Circuit  2
        Caller  6
        circuit  2
        circuit destination  6                up, host  5
        circuit initiation  6
        circuit origination  6
        circuit termination  6


        destination, circuit  6
        down, host  5


        free port  8


        host down  5
        host number  5
        host open  5
        host port limit  5
        host shut  5
        HOST State  5
        host up  5
        HOSTS  6


        initiation, circuit  6
        ISIS Host Interface  2


        Network ID  17
        network throughput capability  18
        NID  17


        open, host  5
        origination, circuit  6


        Packets  3


        Reset Dialog  3

        24                   Tymshare Base-Host Protocols             TBASE.DOC
 2@p